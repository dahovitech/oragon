{% extends 'base.html.twig' %}

{% block title %}{{ service.getTitle(currentLanguage.code) }} - Oragon{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style>
        .service-hero {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4rem 0;
            margin-top: -76px;
            padding-top: 8rem;
        }

        .service-content {
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-radius: 15px;
            margin-top: -2rem;
            position: relative;
            z-index: 2;
        }

        .feature-highlight {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border-radius: 15px;
            padding: 2rem;
            margin: 2rem 0;
        }

        .translation-badge {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .service-card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .service-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }

        .action-btn {
            border-radius: 25px;
            padding: 0.75rem 1.5rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            transform: translateY(-2px);
        }

        .breadcrumb {
            background: transparent;
            padding: 0;
        }

        .breadcrumb-item + .breadcrumb-item::before {
            color: white;
        }

        .breadcrumb-item a {
            color: rgba(255,255,255,0.8);
            text-decoration: none;
        }

        .breadcrumb-item.active {
            color: white;
        }
    </style>
{% endblock %}

{% block body %}
<!-- Service Hero Section -->
<section class="service-hero">
    <div class="container">
        {# Breadcrumb #}
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a href="{{ path('homepage') }}">
                        <i class="bi bi-house-fill me-1"></i>Accueil
                    </a>
                </li>
                <li class="breadcrumb-item">
                    <a href="#services">Services</a>
                </li>
                <li class="breadcrumb-item active" aria-current="page">
                    {{ service.getTitle(currentLanguage.code) }}
                </li>
            </ol>
        </nav>

        <div class="row align-items-center">
            <div class="col-lg-8">
                <div class="d-flex align-items-center mb-3">
                    <div class="me-4">
                        <i class="bi bi-gear-wide-connected" style="font-size: 4rem;"></i>
                    </div>
                    <div>
                        <h1 class="display-4 fw-bold mb-2">
                            {{ translation ? translation.title : service.slug }}
                        </h1>
                        {# Language indicator if content is not in current language #}
                        {% if translation and translation.language != currentLanguage %}
                            <span class="badge bg-warning text-dark translation-badge">
                                <i class="bi bi-info-circle me-1"></i>
                                Affiché en {{ translation.language.nativeName }}
                            </span>
                        {% endif %}
                    </div>
                </div>
                
                {% if translation and translation.description %}
                    <p class="lead mb-4" style="font-size: 1.3rem;">
                        {{ translation.description }}
                    </p>
                {% endif %}
                
                <div class="d-flex flex-wrap gap-3">
                    <a href="#contact" class="btn btn-light btn-lg action-btn">
                        <i class="bi bi-telephone me-2"></i>Nous contacter
                    </a>
                    <a href="{{ path('homepage') }}#services" class="btn btn-outline-light btn-lg action-btn">
                        <i class="bi bi-grid me-2"></i>Tous nos services
                    </a>
                </div>
            </div>
            <div class="col-lg-4 text-center">
                <div class="floating">
                    <i class="bi bi-stars text-white" style="font-size: 10rem; opacity: 0.3;"></i>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Service Content Section -->
<section class="py-5">
    <div class="container">
        <div class="row">
            <div class="col-lg-8">
                <div class="card service-content">
                    <div class="card-body p-5">
                        {% if translation and translation.detail %}
                            <h2 class="mb-4">Description détaillée</h2>
                            <div class="content" style="line-height: 1.8; font-size: 1.1rem;">
                                {{ translation.detail|nl2br }}
                            </div>
                        {% else %}
                            <div class="text-center py-5">
                                <i class="bi bi-info-circle display-1 text-muted mb-4"></i>
                                <h3 class="text-muted mb-3">Contenu en cours de rédaction</h3>
                                <p class="text-muted">
                                    Le contenu détaillé de ce service n'est pas encore disponible dans la langue sélectionnée.
                                    Contactez-nous pour plus d'informations.
                                </p>
                                <a href="#contact" class="btn btn-primary mt-3">
                                    <i class="bi bi-envelope me-2"></i>Nous contacter
                                </a>
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Feature Highlight -->
                <div class="feature-highlight">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h3 class="mb-3">
                                <i class="bi bi-rocket-takeoff me-2"></i>
                                Prêt à démarrer votre projet ?
                            </h3>
                            <p class="mb-0">
                                Contactez notre équipe d'experts pour discuter de vos besoins 
                                et obtenir un devis personnalisé gratuitement.
                            </p>
                        </div>
                        <div class="col-md-4 text-center">
                            <a href="#contact" class="btn btn-light btn-lg action-btn">
                                <i class="bi bi-send me-2"></i>Démarrer
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-4">
                <!-- Language selector -->
                {% if languages|length > 1 %}
                    <div class="card service-card mb-4">
                        <div class="card-header bg-primary text-white">
                            <h6 class="card-title mb-0">
                                <i class="bi bi-globe me-2"></i>Langue d'affichage
                            </h6>
                        </div>
                        <div class="card-body">
                            <select class="form-select mb-3" onchange="switchLanguage(this.value)">
                                {% for language in languages %}
                                    <option value="{{ language.code }}" 
                                            {% if currentLanguage.code == language.code %}selected{% endif %}>
                                        {{ language.nativeName }}
                                        {% if language.default %} (Défaut){% endif %}
                                    </option>
                                {% endfor %}
                            </select>
                            
                            <!-- Show available translations -->
                            <small class="text-muted d-block mb-2">Traductions disponibles :</small>
                            <div class="d-flex flex-wrap gap-1">
                                {% for language in languages %}
                                    {% set langTranslation = service.getTranslationForLanguage(language) %}
                                    <span class="badge {% if langTranslation and langTranslation.title %}bg-success{% else %}bg-secondary{% endif %}">
                                        {{ language.code|upper }}
                                        {% if langTranslation and langTranslation.title %}
                                            <i class="bi bi-check-lg ms-1"></i>
                                        {% else %}
                                            <i class="bi bi-x-lg ms-1"></i>
                                        {% endif %}
                                    </span>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                {% endif %}
                
                <!-- Service info -->
                <div class="card service-card mb-4">
                    <div class="card-header bg-info text-white">
                        <h6 class="card-title mb-0">
                            <i class="bi bi-info-circle me-2"></i>Informations
                        </h6>
                    </div>
                    <div class="card-body">
                        <dl class="row mb-0">
                            <dt class="col-5">Service :</dt>
                            <dd class="col-7"><code>{{ service.slug }}</code></dd>
                            
                            <dt class="col-5">Mis à jour :</dt>
                            <dd class="col-7">
                                <small class="text-muted">{{ service.updatedAt|date('d/m/Y') }}</small>
                            </dd>
                            
                            {% if translation and translation.updatedAt %}
                                <dt class="col-5">Traduction :</dt>
                                <dd class="col-7">
                                    <small class="text-muted">{{ translation.updatedAt|date('d/m/Y') }}</small>
                                </dd>
                            {% endif %}
                        </dl>
                    </div>
                </div>
                
                <!-- Quick Actions -->
                <div class="card service-card">
                    <div class="card-header bg-success text-white">
                        <h6 class="card-title mb-0">
                            <i class="bi bi-lightning-fill me-2"></i>Actions rapides
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-3">
                            <a href="#contact" class="btn btn-primary action-btn">
                                <i class="bi bi-envelope me-2"></i>Demander un devis
                            </a>
                            
                            <a href="{{ path('homepage') }}#services" class="btn btn-outline-primary action-btn">
                                <i class="bi bi-arrow-left me-2"></i>Autres services
                            </a>
                            
                            <a href="{{ path('service_search') }}" class="btn btn-outline-secondary action-btn">
                                <i class="bi bi-search me-2"></i>Rechercher
                            </a>
                            
                            <button class="btn btn-outline-info action-btn" onclick="shareService()">
                                <i class="bi bi-share me-2"></i>Partager
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Contact Section -->
<section id="contact" class="py-5 bg-light">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 mx-auto text-center">
                <h2 class="display-5 fw-bold mb-4">Intéressé par ce service ?</h2>
                <p class="lead mb-4">
                    Notre équipe est là pour vous accompagner dans votre projet. 
                    Contactez-nous pour une consultation gratuite.
                </p>
                
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <div class="card service-card">
                            <div class="card-body text-center p-4">
                                <i class="bi bi-envelope-fill text-primary mb-3" style="font-size: 3rem;"></i>
                                <h5>Email</h5>
                                <p class="text-muted">jprud67@gmail.com</p>
                                <a href="mailto:jprud67@gmail.com" class="btn btn-outline-primary">Écrire</a>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4 mb-3">
                        <div class="card service-card">
                            <div class="card-body text-center p-4">
                                <i class="bi bi-telephone-fill text-success mb-3" style="font-size: 3rem;"></i>
                                <h5>Téléphone</h5>
                                <p class="text-muted">+33 1 23 45 67 89</p>
                                <a href="tel:+33123456789" class="btn btn-outline-success">Appeler</a>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4 mb-3">
                        <div class="card service-card">
                            <div class="card-body text-center p-4">
                                <i class="bi bi-calendar-fill text-info mb-3" style="font-size: 3rem;"></i>
                                <h5>Rendez-vous</h5>
                                <p class="text-muted">Consultation gratuite</p>
                                <a href="#" class="btn btn-outline-info">Planifier</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_javascripts %}
    {{ parent() }}
    <script>
        function shareService() {
            if (navigator.share) {
                navigator.share({
                    title: '{{ service.getTitle(currentLanguage.code)|e('js') }}',
                    text: '{{ translation and translation.description ? translation.description|e('js') : 'Découvrez ce service sur Oragon' }}',
                    url: window.location.href
                }).catch(console.error);
            } else {
                // Fallback: copy to clipboard
                navigator.clipboard.writeText(window.location.href).then(function() {
                    alert('Lien copié dans le presse-papiers !');
                }).catch(function() {
                    alert('URL: ' + window.location.href);
                });
            }
        }
        
        function switchLanguage(languageCode) {
            axios.post(`/api/switch-language/${languageCode}`)
                .then(response => {
                    if (response.data.success) {
                        window.location.reload();
                    }
                })
                .catch(error => {
                    console.error('Erreur lors du changement de langue:', error);
                    window.location.reload();
                });
        }
    </script>
{% endblock %}
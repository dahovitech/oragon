{% extends "emails/base.html.twig" %}

{% block title %}FÃ©licitations ! Contrat signÃ© - EdgeLoan{% endblock %}

{% block header_title %}ğŸ‰ Contrat signÃ© avec succÃ¨s !{% endblock %}

{% block content %}
<h2>FÃ©licitations {{ user.firstName }} {{ user.lastName }} !</h2>

<p>
    <strong>Excellente nouvelle !</strong> Votre contrat de prÃªt a Ã©tÃ© signÃ© avec succÃ¨s. 
    Votre projet devient maintenant rÃ©alitÃ© ! ğŸš€
</p>

<div class="info-box success">
    <h3>âœ… Signature confirmÃ©e</h3>
    <p><strong>Contrat :</strong> {{ contract.contractNumber }}</p>
    <p><strong>Date de signature :</strong> {{ contract.signedAt|date('d/m/Y Ã  H:i') ?? "now"|date('d/m/Y Ã  H:i') }}</p>
    <p><strong>Statut :</strong> <span style="color: #28a745; font-weight: bold;">Actif</span></p>
</div>

<div class="amount">
    {{ application.requestedAmount|number_format(0, ',', ' ') }} â‚¬
</div>
<p style="text-align: center; color: #28a745; font-weight: bold;">ACCORDÃ‰S - CONTRAT SIGNÃ‰</p>

<div class="application-details">
    <h3>ğŸ’° DÃ©tails de votre prÃªt actif</h3>
    
    <div class="detail-row">
        <span class="detail-label">Capital accordÃ© :</span>
        <span class="detail-value"><strong>{{ application.requestedAmount|number_format(0, ',', ' ') }} â‚¬</strong></span>
    </div>
    
    <div class="detail-row">
        <span class="detail-label">DurÃ©e :</span>
        <span class="detail-value">{{ application.loanTerm }} mois</span>
    </div>
    
    {% if application.monthlyPayment %}
    <div class="detail-row">
        <span class="detail-label">MensualitÃ© :</span>
        <span class="detail-value"><strong>{{ application.monthlyPayment|number_format(2, ',', ' ') }} â‚¬</strong></span>
    </div>
    {% endif %}
    
    {% if application.interestRate %}
    <div class="detail-row">
        <span class="detail-label">Taux (TAEG) :</span>
        <span class="detail-value">{{ application.interestRate }}%</span>
    </div>
    {% endif %}
    
    <div class="detail-row">
        <span class="detail-label">PremiÃ¨re Ã©chÃ©ance :</span>
        <span class="detail-value">{{ contract.firstPaymentDate|date('d/m/Y') ?? ("+1 month"|date('d/m/Y')) }}</span>
    </div>
</div>

<div class="info-box success">
    <h3>ğŸ’¸ DÃ©blocage des fonds - Ã‰tapes finales</h3>
    <ol>
        <li><strong>Validation finale</strong> - VÃ©rification administrative (2-4h)</li>
        <li><strong>PrÃ©paration du virement</strong> - Ordre de virement gÃ©nÃ©rÃ©</li>
        <li><strong>DÃ©blocage effectif</strong> - <strong>Virement sous 24-48h maximum</strong></li>
        <li><strong>Confirmation</strong> - Email de confirmation du virement</li>
    </ol>
</div>

<div class="info-box">
    <h3>ğŸ¦ CoordonnÃ©es bancaires</h3>
    <p><strong>Le virement sera effectuÃ© sur le compte :</strong></p>
    <p style="font-family: monospace; background-color: #f8f9fa; padding: 10px; border-radius: 4px;">
        {% if user.bankAccount %}
            IBAN: {{ user.bankAccount.iban|upper }}<br>
            Titulaire: {{ user.firstName }} {{ user.lastName }}
        {% else %}
            Selon les coordonnÃ©es fournies lors de votre demande
        {% endif %}
    </p>
</div>

<p style="text-align: center;">
    <a href="{{ url('user_dashboard') }}" class="btn">AccÃ©der Ã  mon espace client</a>
</p>

<div class="info-box warning">
    <h3>ğŸ“‹ Vos prochaines obligations</h3>
    <p><strong>PremiÃ¨re mensualitÃ© :</strong></p>
    <ul>
        <li>Date de prÃ©lÃ¨vement : <strong>{{ contract.firstPaymentDate|date('d/m/Y') ?? ("+1 month"|date('d/m/Y')) }}</strong></li>
        <li>Montant : <strong>{{ application.monthlyPayment|number_format(2, ',', ' ') ?? 'Voir contrat' }} â‚¬</strong></li>
        <li>Mode : PrÃ©lÃ¨vement automatique</li>
    </ul>
</div>

<div class="info-box">
    <h3>ğŸ“± Gestion de votre prÃªt</h3>
    <p>Depuis votre espace client, vous pouvez :</p>
    <ul>
        <li>Consulter votre Ã©chÃ©ancier complet</li>
        <li>Suivre vos remboursements</li>
        <li>Simuler un remboursement anticipÃ©</li>
        <li>TÃ©lÃ©charger vos documents</li>
        <li>Modifier vos coordonnÃ©es</li>
        <li>Contacter votre conseiller</li>
    </ul>
</div>

<div class="info-box">
    <h3>âš ï¸ Important - Assurance emprunteur</h3>
    {% if contract.hasInsurance %}
        <p>Votre prÃªt est couvert par une assurance emprunteur pour votre sÃ©curitÃ©.</p>
    {% else %}
        <p>
            Nous vous rappelons l'importance de souscrire une assurance emprunteur 
            pour protÃ©ger votre famille en cas d'imprÃ©vu.
        </p>
    {% endif %}
</div>

<div class="info-box success">
    <h3>ğŸ¯ Conseils pour bien gÃ©rer votre prÃªt</h3>
    <ul>
        <li>Assurez-vous d'avoir des provisions suffisantes sur votre compte</li>
        <li>Notez la date de prÃ©lÃ¨vement dans votre calendrier</li>
        <li>Conservez tous les documents relatifs Ã  votre prÃªt</li>
        <li>N'hÃ©sitez pas Ã  nous contacter en cas de difficultÃ©</li>
        <li>Informez-nous de tout changement dans votre situation</li>
    </ul>
</div>

<p>
    <strong>Questions ou besoin d'aide ?</strong><br>
    Votre conseiller EdgeLoan reste Ã  votre disposition tout au long de votre prÃªt. 
    Contactez-nous au <strong>01 23 45 67 89</strong> ou par email Ã  <strong>suivi@edgeloan.fr</strong>.
</p>

<p>
    Merci de votre confiance et fÃ©licitations encore pour la concrÃ©tisation de votre projet !
</p>

<p>
    Cordialement,<br>
    <strong>L'Ã©quipe EdgeLoan</strong>
</p>
{% endblock %}
{% extends "emails/base.html.twig" %}

{% block title %}Rappel d'√©ch√©ance - EdgeLoan{% endblock %}

{% block header_title %}‚è∞ Rappel d'√©ch√©ance{% endblock %}

{% block content %}
<h2>Bonjour {{ user.firstName }} {{ user.lastName }},</h2>

<p>
    Nous vous informons qu'une ou plusieurs √©ch√©ances de votre pr√™t EdgeLoan sont arriv√©es √† √©ch√©ance.
</p>

<div class="info-box warning">
    <h3>üìã Contrat concern√©</h3>
    <p><strong>Num√©ro :</strong> {{ contract.contractNumber }}</p>
    <p><strong>Montant initial :</strong> {{ contract.initialAmount|number_format(0, ',', ' ') }} ‚Ç¨</p>
    <p><strong>Capital restant d√ª :</strong> {{ contract.remainingBalance|number_format(2, ',', ' ') }} ‚Ç¨</p>
</div>

<div class="info-box error">
    <h3>üí∞ √âch√©ances en retard</h3>
    {% set totalOverdue = 0 %}
    {% for payment in overduePayments %}
        {% set totalOverdue = totalOverdue + payment.amount %}
        <div class="detail-row">
            <span class="detail-label">{{ payment.dueDate|date('d/m/Y') }} :</span>
            <span class="detail-value"><strong>{{ payment.amount|number_format(2, ',', ' ') }} ‚Ç¨</strong></span>
        </div>
    {% endfor %}
    
    <hr style="margin: 15px 0;">
    <div class="detail-row">
        <span class="detail-label"><strong>TOTAL √Ä R√âGLER :</strong></span>
        <span class="detail-value" style="color: #dc3545;"><strong>{{ totalOverdue|number_format(2, ',', ' ') }} ‚Ç¨</strong></span>
    </div>
</div>

<div class="info-box">
    <h3>üìÖ Historique des paiements</h3>
    <p>Nombre d'√©ch√©ances en retard : <strong>{{ overduePayments|length }}</strong></p>
    <p>Retard le plus ancien : <strong>{{ overduePayments|first.dueDate|date('d/m/Y') }}</strong></p>
</div>

<p style="text-align: center;">
    <a href="{{ url('user_payments') }}" class="btn">Effectuer un paiement</a>
</p>

<div class="info-box warning">
    <h3>‚ö†Ô∏è Cons√©quences du retard de paiement</h3>
    <ul>
        <li>P√©nalit√©s de retard selon les conditions contractuelles</li>
        <li>Impact possible sur votre historique de cr√©dit</li>
        <li>Frais suppl√©mentaires de recouvrement</li>
        <li>Risque de r√©siliation du contrat en cas de retard prolong√©</li>
    </ul>
</div>

<div class="info-box">
    <h3>üí° Solutions de paiement disponibles</h3>
    <ul>
        <li><strong>Paiement en ligne</strong> - Imm√©diat via votre espace client</li>
        <li><strong>Virement bancaire</strong> - RIB disponible dans votre espace</li>
        <li><strong>Pr√©l√®vement automatique</strong> - Activez cette option pour √©viter les oublis</li>
        <li><strong>Paiement par t√©l√©phone</strong> - Appelez nos conseillers</li>
    </ul>
</div>

<div class="application-details">
    <h3>üè¶ Coordonn√©es pour virement</h3>
    
    <div class="detail-row">
        <span class="detail-label">B√©n√©ficiaire :</span>
        <span class="detail-value">EdgeLoan SAS</span>
    </div>
    
    <div class="detail-row">
        <span class="detail-label">IBAN :</span>
        <span class="detail-value">FR76 1234 5678 9012 3456 7890 123</span>
    </div>
    
    <div class="detail-row">
        <span class="detail-label">BIC :</span>
        <span class="detail-value">EDGEFRPPXXX</span>
    </div>
    
    <div class="detail-row">
        <span class="detail-label">R√©f√©rence :</span>
        <span class="detail-value">{{ contract.contractNumber }} - {{ user.lastName|upper }}</span>
    </div>
</div>

<div class="info-box success">
    <h3>ü§ù Difficult√©s de paiement ?</h3>
    <p>
        Si vous traversez une p√©riode difficile, <strong>contactez-nous rapidement</strong>. 
        Nous pouvons √©tudier ensemble des solutions adapt√©es :
    </p>
    <ul>
        <li>Report d'√©ch√©ances temporaire</li>
        <li>R√©vision du plan de remboursement</li>
        <li>Solutions d'accompagnement personnalis√©</li>
    </ul>
</div>

<p>
    <strong>R√©gularisation urgente :</strong><br>
    Pour √©viter des frais suppl√©mentaires et pr√©server votre cr√©dit, nous vous invitons 
    √† r√©gulariser votre situation dans les <strong>5 jours ouvr√©s</strong>.
</p>

<p>
    <strong>Contact privil√©gi√© :</strong><br>
    Pour toute question relative √† vos paiements, contactez directement notre service recouvrement 
    au <strong>01 23 45 67 90</strong> ou par email √† <strong>recouvrement@edgeloan.fr</strong>.
</p>

<p>
    Merci de votre compr√©hension et de votre collaboration.
</p>

<p>
    Cordialement,<br>
    <strong>Le Service Recouvrement EdgeLoan</strong>
</p>
{% endblock %}
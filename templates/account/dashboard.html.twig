{% extends 'base.html.twig' %}

{% block title %}{{ 'account.dashboard'|trans }} - {{ parent() }}{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('assets/css/vendors/datatables.css') }}">
{% endblock %}

{% block body %}
<!-- breadcrumb start -->
<div class="breadcrumb-section">
    <div class="container">
        <div class="row">
            <div class="col-sm-6">
                <div class="page-title">
                    <h2>{{ 'account.dashboard'|trans }}</h2>
                </div>
            </div>
            <div class="col-sm-6">
                <nav aria-label="breadcrumb" class="theme-breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="{{ path('home', {'_locale': app.request.locale}) }}">{{ 'nav.home'|trans }}</a></li>
                        <li class="breadcrumb-item active">{{ 'account.dashboard'|trans }}</li>
                    </ol>
                </nav>
            </div>
        </div>
    </div>
</div>
<!-- breadcrumb End -->

<!-- section start -->
<section class="section-b-space">
    <div class="container">
        <div class="row">
            <div class="col-lg-3">
                {{ include('account/_sidebar.html.twig') }}
            </div>
            <div class="col-lg-9">
                <!-- Welcome Section -->
                <div class="dashboard-welcome">
                    <div class="welcome-content">
                        <h3>{{ 'account.welcome_back'|trans }} {{ app.user.firstName }}!</h3>
                        <p>{{ 'account.dashboard_intro'|trans }}</p>
                    </div>
                </div>

                <!-- Stats Cards -->
                <div class="row dashboard-stats">
                    <div class="col-lg-3 col-md-6 col-sm-6">
                        <div class="dashboard-card">
                            <div class="card-icon">
                                <i class="fa fa-shopping-bag"></i>
                            </div>
                            <div class="card-content">
                                <h4>{{ stats.total_orders }}</h4>
                                <p>{{ 'account.total_orders'|trans }}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 col-sm-6">
                        <div class="dashboard-card">
                            <div class="card-icon">
                                <i class="fa fa-credit-card"></i>
                            </div>
                            <div class="card-content">
                                <h4>{{ stats.total_spent|currency(app.request.locale) }}</h4>
                                <p>{{ 'account.total_spent'|trans }}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 col-sm-6">
                        <div class="dashboard-card">
                            <div class="card-icon">
                                <i class="fa fa-heart"></i>
                            </div>
                            <div class="card-content">
                                <h4>{{ stats.wishlist_count }}</h4>
                                <p>{{ 'account.wishlist_items'|trans }}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 col-sm-6">
                        <div class="dashboard-card">
                            <div class="card-icon">
                                <i class="fa fa-star"></i>
                            </div>
                            <div class="card-content">
                                <h4>{{ stats.reviews_count }}</h4>
                                <p>{{ 'account.reviews_written'|trans }}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Orders -->
                {% if recent_orders|length > 0 %}
                <div class="dashboard-section">
                    <div class="section-header">
                        <h4>{{ 'account.recent_orders'|trans }}</h4>
                        <a href="{{ path('account_orders', {'_locale': app.request.locale}) }}" class="btn btn-outline btn-sm">{{ 'account.view_all'|trans }}</a>
                    </div>
                    <div class="table-responsive">
                        <table class="table order-table">
                            <thead>
                                <tr>
                                    <th>{{ 'order.number'|trans }}</th>
                                    <th>{{ 'order.date'|trans }}</th>
                                    <th>{{ 'order.status'|trans }}</th>
                                    <th>{{ 'order.total'|trans }}</th>
                                    <th>{{ 'order.actions'|trans }}</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for order in recent_orders %}
                                <tr>
                                    <td>
                                        <a href="{{ path('account_order_detail', {'orderNumber': order.orderNumber, '_locale': app.request.locale}) }}" class="order-link">
                                            #{{ order.orderNumber }}
                                        </a>
                                    </td>
                                    <td>{{ order.createdAt|date('d/m/Y') }}</td>
                                    <td>
                                        <span class="status-badge status-{{ order.status }}">
                                            {{ ('order.status.' ~ order.status)|trans }}
                                        </span>
                                    </td>
                                    <td>{{ order.totalAmount|currency(app.request.locale) }}</td>
                                    <td>
                                        <div class="action-buttons">
                                            <a href="{{ path('account_order_detail', {'orderNumber': order.orderNumber, '_locale': app.request.locale}) }}" 
                                               class="btn btn-sm btn-outline" title="{{ 'order.view_details'|trans }}">
                                                <i class="fa fa-eye"></i>
                                            </a>
                                            {% if order.status in ['delivered', 'completed'] %}
                                                <button type="button" class="btn btn-sm btn-solid reorder-btn" 
                                                        data-order-id="{{ order.id }}" title="{{ 'order.reorder'|trans }}">
                                                    <i class="fa fa-refresh"></i>
                                                </button>
                                            {% endif %}
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                {% endif %}

                <!-- Quick Actions -->
                <div class="dashboard-section">
                    <div class="section-header">
                        <h4>{{ 'account.quick_actions'|trans }}</h4>
                    </div>
                    <div class="row quick-actions">
                        <div class="col-lg-4 col-md-6">
                            <div class="action-card">
                                <div class="action-icon">
                                    <i class="fa fa-user"></i>
                                </div>
                                <div class="action-content">
                                    <h5>{{ 'account.update_profile'|trans }}</h5>
                                    <p>{{ 'account.profile_description'|trans }}</p>
                                    <a href="{{ path('account_profile', {'_locale': app.request.locale}) }}" class="btn btn-solid btn-sm">
                                        {{ 'account.edit_profile'|trans }}
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-6">
                            <div class="action-card">
                                <div class="action-icon">
                                    <i class="fa fa-map-marker"></i>
                                </div>
                                <div class="action-content">
                                    <h5>{{ 'account.manage_addresses'|trans }}</h5>
                                    <p>{{ 'account.addresses_description'|trans }}</p>
                                    <a href="{{ path('account_addresses', {'_locale': app.request.locale}) }}" class="btn btn-solid btn-sm">
                                        {{ 'account.edit_addresses'|trans }}
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-6">
                            <div class="action-card">
                                <div class="action-icon">
                                    <i class="fa fa-heart"></i>
                                </div>
                                <div class="action-content">
                                    <h5>{{ 'account.wishlist'|trans }}</h5>
                                    <p>{{ 'account.wishlist_description'|trans }}</p>
                                    <a href="{{ path('wishlist_index', {'_locale': app.request.locale}) }}" class="btn btn-solid btn-sm">
                                        {{ 'account.view_wishlist'|trans }}
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Account Activity -->
                <div class="dashboard-section">
                    <div class="section-header">
                        <h4>{{ 'account.recent_activity'|trans }}</h4>
                    </div>
                    <div class="activity-timeline">
                        {% for order in recent_orders|slice(0, 3) %}
                        <div class="activity-item">
                            <div class="activity-icon">
                                <i class="fa fa-shopping-cart"></i>
                            </div>
                            <div class="activity-content">
                                <div class="activity-header">
                                    <span class="activity-title">{{ 'activity.order_placed'|trans }}</span>
                                    <span class="activity-time">{{ order.createdAt|ago }}</span>
                                </div>
                                <div class="activity-description">
                                    {{ 'activity.order_description'|trans({'%orderNumber%': order.orderNumber, '%total%': order.totalAmount|currency(app.request.locale)}) }}
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                        
                        {% if stats.reviews_count > 0 %}
                        <div class="activity-item">
                            <div class="activity-icon">
                                <i class="fa fa-star"></i>
                            </div>
                            <div class="activity-content">
                                <div class="activity-header">
                                    <span class="activity-title">{{ 'activity.review_written'|trans }}</span>
                                    <span class="activity-time">{{ 'activity.this_month'|trans }}</span>
                                </div>
                                <div class="activity-description">
                                    {{ 'activity.reviews_description'|trans({'%count%': stats.reviews_count}) }}
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- section end -->
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        $(document).ready(function() {
            // Reorder functionality
            $('.reorder-btn').on('click', function() {
                const orderId = $(this).data('order-id');
                
                if (confirm('{{ 'order.confirm_reorder'|trans }}')) {
                    $.ajax({
                        url: '{{ path('account_reorder', {'_locale': app.request.locale}) }}',
                        method: 'POST',
                        data: {
                            order_id: orderId
                        },
                        success: function(data) {
                            if (data.success) {
                                toastr.success('{{ 'order.reorder_success'|trans }}');
                                // Redirect to cart or checkout
                                window.location.href = data.redirect_url || '{{ path('cart_index', {'_locale': app.request.locale}) }}';
                            } else {
                                toastr.error(data.message || '{{ 'error.generic'|trans }}');
                            }
                        },
                        error: function() {
                            toastr.error('{{ 'error.generic'|trans }}');
                        }
                    });
                }
            });
        });
    </script>
{% endblock %}

{% block extra_styles %}
<style>
    .dashboard-welcome {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 2rem;
        border-radius: 10px;
        margin-bottom: 2rem;
    }
    
    .dashboard-stats {
        margin-bottom: 2rem;
    }
    
    .dashboard-card {
        background: white;
        padding: 1.5rem;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
    }
    
    .dashboard-card .card-icon {
        font-size: 2.5rem;
        margin-right: 1rem;
        color: #667eea;
    }
    
    .dashboard-card .card-content h4 {
        font-size: 1.8rem;
        font-weight: bold;
        margin: 0;
        color: #333;
    }
    
    .dashboard-card .card-content p {
        margin: 0;
        color: #666;
        font-size: 0.9rem;
    }
    
    .dashboard-section {
        background: white;
        padding: 1.5rem;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        margin-bottom: 2rem;
    }
    
    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid #eee;
    }
    
    .status-badge {
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
    }
    
    .status-pending { background-color: #ffeaa7; color: #fdcb6e; }
    .status-processing { background-color: #74b9ff; color: white; }
    .status-shipped { background-color: #00b894; color: white; }
    .status-delivered { background-color: #00b894; color: white; }
    .status-cancelled { background-color: #fd79a8; color: white; }
    
    .action-buttons {
        display: flex;
        gap: 0.5rem;
    }
    
    .quick-actions {
        gap: 1rem;
    }
    
    .action-card {
        background: #f8f9fa;
        padding: 1.5rem;
        border-radius: 8px;
        text-align: center;
        height: 100%;
        margin-bottom: 1rem;
    }
    
    .action-icon {
        font-size: 2rem;
        color: #667eea;
        margin-bottom: 1rem;
    }
    
    .activity-timeline {
        position: relative;
    }
    
    .activity-item {
        display: flex;
        margin-bottom: 1.5rem;
        position: relative;
    }
    
    .activity-icon {
        width: 40px;
        height: 40px;
        background: #667eea;
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 1rem;
        flex-shrink: 0;
    }
    
    .activity-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 0.5rem;
    }
    
    .activity-title {
        font-weight: 600;
        color: #333;
    }
    
    .activity-time {
        color: #666;
        font-size: 0.875rem;
    }
    
    .activity-description {
        color: #666;
        font-size: 0.9rem;
    }
    
    .order-link {
        font-weight: 600;
        color: #667eea;
        text-decoration: none;
    }
    
    .order-link:hover {
        text-decoration: underline;
    }
</style>
{% endblock %}